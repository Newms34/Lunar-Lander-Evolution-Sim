const app=angular.module("lb-app",[]).controller("ground-control",["$scope","$interval",function(s,e){s.w=$(window).width(),s.h=$(window).height(),s.g=.1,s.engines=[],s.bestWorstMode=!0,s.gens=0,s.ships=[],s.bestScore=1e6,s.Thruster=function(s,e,t,i){this.a=s,this.p=e,this.s=t,this.e=i,this.success=1,this.on=!1},s.shipCon=function(e){this.engines=e,this.x=Math.floor(s.w/2),this.y=s.h-52,this.dx=0,this.dy=0,this.fuel=500,this.start=(new Date).getTime(),this.engHasFired=!1,this.lastDeactivatedTime=!1,this.score=0,this.pointerAng=0},s.mutaRate=.75,s.mutation=!1,s.moon={x:.6,y:.2},s.getDist=function(s,e,t,i){return Math.sqrt(Math.pow(Math.abs(t-s),2)+Math.pow(Math.abs(i-e),2))},s.allStalled=!1,s.ticker=e(function(){if(s.restart)s.init();else{s.allStalled=!0;for(var e=0;e<s.ships.length;e++){for(var t=0,i=0,n=(new Date).getTime(),a=0;a<s.ships[e].engines.length;a++){var h=0;s.ships[e].engines[a].s+s.ships[e].start<n&&s.ships[e].engines[a].e+s.ships[e].engines[a].s+s.ships[e].start>n?(s.ships[e].engines[a].on=!0,t-=s.ships[e].engines[a].p*Math.sin(s.ships[e].engines[a].a*Math.PI/180),i+=s.ships[e].engines[a].p*Math.cos(s.ships[e].engines[a].a*Math.PI/180),h++,s.ships[e].lastDeactivatedTime=!1,s.ships[e].engHasFired=!0):s.ships[e].engines[a].on=!1,h||s.ships[e].lastDeactivatedTime||"number"==typeof s.ships[e].lastDeactivatedTime||(s.ships[e].lastDeactivatedTime=(new Date).getTime())}s.ships[e].dx+=.01*Math.floor(t),s.ships[e].dy+=.01*Math.floor(i),s.ships[e].pointerAng=180*Math.atan((0-s.ships[e].dy)/(0-s.ships[e].dx))/Math.PI,s.ships[e].dy<=0&&(s.ships[e].pointerAng-=180),s.ships[e].engHasFired&&(s.ships[e].dy+=s.g),s.ships[e].x+=Math.floor(s.ships[e].dx),s.ships[e].y+=Math.floor(s.ships[e].dy);var o=s.getDist(s.ships[e].x,s.ships[e].y,s.moon.x*s.w,s.moon.y*s.h),r=s.getDist(s.ships[e].dx,0,s.ships[e].dy,0);s.ships[e].score=o+r,Math.floor(s.ships[e].score)<s.bestScore&&(s.bestScore=Math.floor(s.ships[e].score)),(s.ships[e].x<0||s.ships[e].x>s.w-50||s.ships[e].y<0||s.ships[e].y>s.h-50)&&(s.restart=!0),s.ships[e].lastDeactivatedTime&&"number"==typeof s.ships[e].lastDeactivatedTime&&(new Date).getTime()-s.ships[e].lastDeactivatedTime<2e4&&(s.allStalled=!1),s.allStalled&&(s.restart=!0),o<100&&(s.restart=!0)}}},50),s.makeNewShip=function(e,t){if(s.gens++,e&&t){if(!s.bestWorstMode){for(r=[],p=3+Math.ceil(5*Math.random()),g=0;g<p;g++){d=90+Math.floor(180*Math.random()),l=10*Math.random(),m=Math.floor(2e4*Math.random()),M=Math.floor(2e4*Math.random());r.push(new s.Thruster(d,l,m,M))}t=new s.shipCon(r)}p=Math.random()<.7?e.engines.length:t.engines.length;var i=[];s.mutation=!1;var n=!1;if(Math.random()>s.mutaRate&&(n=Math.random(),s.mutation="number"),n<.2)Math.random()>.5?p++:p--;else var a=!1;for(g=0;g<p;g++){try{d=0,l=0,m=0,M=0;e.engines[g]?t.engines[g]?(d=Math.random()<.7&&e.engines[g]?e.engines[g].a:t.engines[g].a,l=Math.random()<.7&&e.engines[g]?e.engines[g].p:t.engines[g].p,m=Math.random()<.7&&e.engines[g]?e.engines[g].s:t.engines[g].s,M=Math.random()<.7&&e.engines[g]?e.engines[g].e:t.engines[g].e):(d=e.engines[g].a,l=e.engines[g].p,m=e.engines[g].s,M=e.engines[g].e):(d=t.engines[g].a,l=t.engines[g].p,m=t.engines[g].s,M=t.engines[g].e)}catch(o){s.ticker=null}n>=.2&&n<.4&&Math.random()>1/p&&!a&&(d=Math.floor(360*Math.random()),a=!0,s.mutation="angle"),n>=.4&&n<.6&&Math.random()>1/p&&!a&&(l=10*Math.random(),a=!0,s.mutation="power"),n>=.6&&n<.8&&Math.random()>1/p&&!a&&(m=Math.floor(2e4*Math.random()),a=!0,s.mutation="start"),n>=.8&&Math.random()>1/p&&!a&&(M=Math.floor(2e4*Math.random()),a=!0,s.mutation="end"),i.push(new s.Thruster(d,l,m,M))}s.mutation&&$("#muta").show(500).hide(1200),s.ships=[new s.shipCon(e.engines),new s.shipCon(i)]}else{for(var h=[],o=0;o<2;o++){for(var r=[],p=3+Math.ceil(5*Math.random()),g=0;g<p;g++){var d=90+Math.floor(180*Math.random()),l=10*Math.random(),m=Math.floor(2e4*Math.random()),M=Math.floor(2e4*Math.random());r.push(new s.Thruster(d,l,m,M))}h.push(r)}s.ships.push(new s.shipCon(h[0]),new s.shipCon(h[1]))}},s.init=function(){s.ships.length?s.ships[0].score<s.ships[1].score?s.makeNewShip(s.ships[0],s.ships[1]):s.makeNewShip(s.ships[1],s.ships[0]):s.makeNewShip(),s.restart=!1},s.init()}]);